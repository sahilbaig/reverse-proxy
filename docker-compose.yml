services:
  # Your Go reverse proxy
  my-proxy:
    build: .
    ports:
      - "7001:7001" # Expose proxy port
    labels:
      - "prometheus.scrape=true" # Enable Prometheus scraping
      - "prometheus.port=7001" # Metrics endpoint port
      - "prometheus.path=/metrics" # Metrics path
    environment:
      - PROXY_TARGET=http://host.docker.internal:8081 # Example target
    restart: unless-stopped

  # Prometheus metrics server
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090" # Prometheus UI
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml # Config file
    depends_on:
      - my-proxy
    restart: unless-stopped
